<section class="cart-page">
  <ng-container *ngIf="cartItems.length > 0; else emptyCart">
    <header class="cart-hero glass-card">
      <div class="hero-copy">
        <p class="eyebrow">Tu selección actual</p>
        <h2>Detalle del carrito</h2>
        <p>Revisá cantidades y descuentos antes de confirmar la compra.</p>
      </div>
      <div class="hero-metrics">
        <div class="metric-card">
          <span class="metric-label">Productos únicos</span>
          <span class="metric-value">{{ cartItems.length }}</span>
        </div>
        <div class="metric-card">
          <span class="metric-label">Unidades</span>
          <span class="metric-value">{{ getTotalQuantity() }}</span>
        </div>
        <div class="metric-card">
          <span class="metric-label">Ahorro total</span>
          <span class="metric-value">{{ getTotalSavings() | currency:'ARS':'symbol':'1.2-2' }}</span>
        </div>
      </div>
    </header>

    <div *ngIf="errorMessage" class="cart-alert">
      <i class="fas fa-exclamation-triangle"></i>
      {{ errorMessage }}
    </div>

    <div class="cart-layout">
      <div class="cart-items">
        <article class="cart-card glass-card" *ngFor="let item of cartItems">
          <header class="cart-card-header">
            <div class="title-group">
              <h3>{{ item.name }}</h3>
              <div class="price-row">
                <span class="current-price">{{ item.price | currency:'ARS':'symbol':'1.2-2' }}</span>
                <span class="original-price" *ngIf="getDiscount(item) > 0">{{ getOriginalPrice(item) | currency:'ARS':'symbol':'1.2-2' }}</span>
                <span class="discount-chip" *ngIf="getDiscount(item) > 0">
                  <i class="fas fa-tag"></i> -{{ getDiscount(item) | number:'1.0-0' }}%
                </span>
              </div>
            </div>
            <button type="button" class="icon-button" (click)="removeItem(item.id)" aria-label="Eliminar producto">
              <i class="fas fa-times"></i>
            </button>
          </header>

          <div class="cart-card-body">
            <div class="quantity-control" aria-label="Controlar cantidad">
              <button type="button" (click)="decrementQuantity(item)" aria-label="Disminuir cantidad">
                <i class="fas fa-minus"></i>
              </button>
              <span>{{ item.quantity }}</span>
              <button type="button" (click)="incrementQuantity(item)" aria-label="Incrementar cantidad">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="line-total">
              <span>Total</span>
              <strong>{{ (item.price * item.quantity) | currency:'ARS':'symbol':'1.2-2' }}</strong>
            </div>
          </div>
        </article>
      </div>

      <aside class="summary-card glass-card">
        <h3>Resumen de compra</h3>
        <ul class="summary-list">
          <li>
            <span>Subtotal</span>
            <span>{{ getSubtotal() | currency:'ARS':'symbol':'1.2-2' }}</span>
          </li>
          <li *ngIf="getTotalSavings() > 0">
            <span>Ahorro aplicado</span>
            <span>-{{ getTotalSavings() | currency:'ARS':'symbol':'1.2-2' }}</span>
          </li>
        </ul>

        <div class="summary-total">
          <span>Total a pagar</span>
          <strong>{{ getTotal() | currency:'ARS':'symbol':'1.2-2' }}</strong>
        </div>

        <p class="summary-note">
          Una vez revisado el detalle, podés descargar un comprobante PDF o continuar con el proceso de pago.
        </p>

        <div class="summary-actions">
          <button type="button" class="btn-secondary" (click)="generatePDF()">
            <i class="fas fa-file-download"></i> Descargar PDF
          </button>
          <button type="button" class="btn-outline" (click)="clearCart()">
            <i class="fas fa-trash"></i> Vaciar carrito
          </button>
          <button type="button" class="btn-primary">
            <i class="fas fa-credit-card"></i> Proceder al pago
          </button>
        </div>
      </aside>
    </div>
  </ng-container>

  <ng-template #emptyCart>
    <div class="empty-state glass-card">
      <i class="fas fa-shopping-basket"></i>
      <h3>Tu carrito está vacío</h3>
      <p>Explorá el catálogo y sumá productos para comenzar tu compra.</p>
      <a routerLink="/productos" class="btn-primary">
        <i class="fas fa-store"></i> Ver productos
      </a>
    </div>
  </ng-template>
</section>