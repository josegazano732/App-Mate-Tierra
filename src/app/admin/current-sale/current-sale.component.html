<section class="sales-container">
  <header class="sales-header">
    <div>
      <p class="eyebrow">Venta en curso</p>
      <h2>Registrar venta</h2>
      <p>Completá los métodos de pago correspondientes y confirmá la operación.</p>
    </div>
    <a routerLink="/ventas" class="btn-secondary-link">
      <i class="fas fa-history"></i>
      Ver ventas recientes
    </a>
  </header>

  <div class="current-sale">
    <div *ngIf="cartItems.length === 0" class="empty-cart">
      No hay productos en el carrito. Agregá artículos desde el catálogo.
    </div>

    <div *ngIf="cartItems.length > 0" class="current-sale-body">
      <table class="items-table">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Precio Unitario</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of cartItems">
            <td>{{ item.name }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.price | currency:'USD' }}</td>
            <td>{{ item.price * item.quantity | currency:'USD' }}</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3" class="total-label">Total</td>
            <td class="total-amount">{{ getTotal() | currency:'USD' }}</td>
          </tr>
        </tfoot>
      </table>

      <div class="payment-section">
        <div class="payment-methods">
          <div class="section-title">
            <h3>Métodos de pago</h3>
            <p>Distribuí el total entre uno o más métodos según corresponda.</p>
          </div>

          <div class="payment-splits">
            <div *ngFor="let split of paymentSplits; let i = index" class="payment-split">
              <div class="form-group">
                <label [for]="'paymentMethod' + i">Método</label>
                <select 
                  [id]="'paymentMethod' + i"
                  [(ngModel)]="split.method"
                  class="payment-select">
                  <option value="">Seleccioná un método</option>
                  <option *ngFor="let method of paymentMethods" [value]="method.code">
                    {{ method.name }}
                  </option>
                </select>
              </div>
              <div class="form-group">
                <label [for]="'amount' + i">Monto</label>
                <input 
                  type="number" 
                  [id]="'amount' + i"
                  [(ngModel)]="split.amount"
                  (ngModelChange)="updateRemainingAmount()"
                  [max]="getMaxAmount(i)"
                  step="0.01"
                  class="amount-input">
              </div>
              <button 
                type="button"
                *ngIf="i > 0" 
                (click)="removePaymentSplit(i)" 
                class="btn-remove-split"
                aria-label="Eliminar método">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>

          <div class="payment-summary" [class.error]="getRemainingAmount() < 0">
            <span>Restante</span>
            <strong>{{ getRemainingAmount() | currency:'USD' }}</strong>
          </div>

          <div class="payment-actions">
            <button 
              type="button"
              (click)="addPaymentSplit()" 
              class="btn-add-split"
              [disabled]="!canAddMoreSplits()">
              <i class="fas fa-plus"></i> Añadir método
            </button>
          </div>
        </div>

        <div class="register-panel">
          <div class="total-highlight">
            <span>Total a cobrar</span>
            <h3>{{ getTotal() | currency:'USD' }}</h3>
          </div>
          <button 
            type="button"
            (click)="registerSale()" 
            class="btn-register"
            [disabled]="!canRegisterSale()">
            <i class="fas fa-cash-register"></i> Confirmar venta
          </button>
          <p *ngIf="errorMessage" class="error-message">{{ errorMessage }}</p>
        </div>
      </div>
    </div>
  </div>
</section>
